# Codebase Structure

**Analysis Date:** 2026-02-17

## Directory Layout

```
AI-Associate/
├── .claude-plugin/              # Claude Code plugin configuration
│   └── plugin.json              # Plugin metadata (name, version, description)
├── .planning/                   # Planning documents (generated by GSD)
│   └── codebase/                # Architecture and structure analysis
├── commands/                    # Slash command definitions
│   ├── sara.md                  # /sara command — activates the skill
│   └── docx-mode.md             # /docx-mode command — toggle MCP vs CLI
├── skills/                      # Skill definitions
│   └── sara/
│       ├── SKILL.md             # Core Sara behavioral framework (250+ lines)
│       └── references/          # Detailed operational guides
│           ├── contract-review-workflow.md     # 5-step structured review process
│           ├── delegation-model.md             # Junior associate management patterns
│           └── work-product-standards.md       # Document type conventions
├── agents/                      # Junior associate subagent definitions
│   ├── legal-researcher.md      # Research tasks, citations, authority analysis
│   ├── document-reviewer.md     # Document review, issue spotting, summaries
│   ├── document-drafter.md      # First-pass drafting, markdown to .docx conversion
│   └── contract-reviser.md      # Batch paragraph revision with risk mapping
├── docx-tools/                  # Document processing system (Python)
│   ├── mcp_server.py            # MCP server exposing 6 document tools
│   ├── core/                    # Core document processing logic (no LLM calls)
│   │   ├── __init__.py
│   │   ├── reader.py            # Parse .docx → structured paragraphs with IDs, sections, defined terms
│   │   ├── writer.py            # Markdown/text → .docx with optional template inheritance
│   │   ├── redliner.py          # Apply revision JSON → .docx with track changes + comment bubbles
│   │   ├── comparer.py          # Diff two .docx files → structured change report
│   │   ├── extractor.py         # Extract sections, defined terms, provision types, exhibits
│   │   └── analyzer.py          # Lightweight risk category mapping (no external AI)
│   ├── cli/                     # CLI scripts wrapping core tools
│   │   ├── read.py              # python docx-tools/cli/read.py <path>
│   │   ├── write.py             # python docx-tools/cli/write.py --input <file> --output <path>
│   │   ├── redline.py           # python docx-tools/cli/redline.py <original> --revised-text <json>
│   │   ├── compare.py           # python docx-tools/cli/compare.py <path_a> <path_b>
│   │   ├── extract.py           # python docx-tools/cli/extract.py <path>
│   │   └── analyze.py           # python docx-tools/cli/analyze.py <path> --representation <role>
│   ├── tests/                   # Unit tests for all core modules
│   │   ├── test_reader.py
│   │   ├── test_writer.py
│   │   ├── test_redliner.py
│   │   ├── test_comparer.py
│   │   ├── test_extractor.py
│   │   └── test_analyzer.py
│   ├── .venv/                   # Python virtual environment (python 3.12)
│   │   └── lib/site-packages/   # Includes python-docx 1.2.0, lxml, diff-match-patch, redlines
│   ├── pyproject.toml           # Python project config (uv lock)
│   └── .pytest_cache/           # Pytest output
├── docs/                        # Documentation and plans
│   └── plans/                   # Implementation plans
│       ├── 2026-02-14-docx-tools-design.md
│       └── 2026-02-14-docx-tools-implementation.md
├── references/                  # Symlinked/copied reference files (same as skills/sara/references/)
│   ├── contract-review-workflow.md
│   ├── delegation-model.md
│   └── work-product-standards.md
├── README.md                    # Project overview and quick start
└── .gitignore                   # Git ignore rules
```

## Directory Purposes

**`.claude-plugin/`:**
- Purpose: Plugin metadata for Claude Code integration
- Contains: `plugin.json` with name, version, description
- Key files: `plugin.json`

**`commands/`:**
- Purpose: Slash command definitions that activate functionality
- Contains: Command invocation handlers that load skills and agents
- Key files: `sara.md` (main entry), `docx-mode.md` (configuration toggle)

**`skills/sara/`:**
- Purpose: Behavioral framework defining Sara's persona and operational patterns
- Contains: Core skill (250+ lines) + reference guides for detailed workflows
- Key files:
  - `SKILL.md` — complete persona definition, delegation protocol, tool usage patterns, quality standards
  - `references/contract-review-workflow.md` — 5-step structured process for contract review
  - `references/delegation-model.md` — patterns for managing junior associates
  - `references/work-product-standards.md` — formatting and quality standards by document type

**`agents/`:**
- Purpose: Specialized subagents that execute delegated tasks under Sara's direction
- Contains: Four junior associate definitions with execution patterns and output formats
- Key files:
  - `legal-researcher.md` — legal research, citations, authority analysis
  - `document-reviewer.md` — document review, issue spotting, term summaries
  - `document-drafter.md` — first-pass drafting with markdown-to-docx conversion
  - `contract-reviser.md` — batch revision of contract paragraphs with risk mapping context

**`docx-tools/core/`:**
- Purpose: Core document processing without external LLM calls
- Contains: Six independent modules for document operations
- Key files:
  - `reader.py` (462 lines) — parses .docx into paragraphs with IDs, sections, hierarchy, defined terms
  - `writer.py` (112 lines) — converts markdown/text to .docx with optional template
  - `redliner.py` (192 lines) — applies revision JSON to generate .docx with track changes and comments
  - `comparer.py` (139 lines) — diffs two .docx files, optionally generates redlined output
  - `extractor.py` (193 lines) — extracts document structure (sections, defined terms, provision types)
  - `analyzer.py` (213 lines) — lightweight risk category mapping by contract type

**`docx-tools/cli/`:**
- Purpose: Command-line interface to core tools (fallback when MCP unavailable)
- Contains: CLI wrappers for each core module
- Usage: `python ${CLAUDE_PLUGIN_ROOT}/docx-tools/cli/[operation].py [args]`

**`docx-tools/.venv/`:**
- Purpose: Isolated Python environment with document processing dependencies
- Contains: python 3.12 with python-docx 1.2.0, lxml, diff-match-patch, redlines
- Activation: `source ${CLAUDE_PLUGIN_ROOT}/docx-tools/.venv/bin/activate`

**`docx-tools/tests/`:**
- Purpose: Unit tests for all document processing modules
- Contains: Test files matching each core module
- Key files: `test_reader.py`, `test_writer.py`, `test_redliner.py`, `test_comparer.py`, `test_extractor.py`, `test_analyzer.py`

**`docs/plans/`:**
- Purpose: Implementation and design documentation
- Contains: Planning documents for features (e.g., docx-tools design and implementation)

**`references/`:**
- Purpose: Operational reference guides (symlinked or copied from skills/sara/references/)
- Contains: Same files as `skills/sara/references/` for easier access

## Key File Locations

**Entry Points:**
- `commands/sara.md` — Slash command definition; sets practice area, loads Sara skill
- `.claude-plugin/plugin.json` — Plugin metadata; registers with Claude Code

**Core Logic:**
- `skills/sara/SKILL.md` — Complete behavioral framework; defines persona, work standards, delegation patterns
- `docx-tools/mcp_server.py` — Exposes 6 document tools via MCP; primary interface for document operations
- `docx-tools/core/reader.py` — Parses .docx files; foundation for all document analysis

**Configuration:**
- `.claude/ai-associate.local.md` — May not exist; if present, contains `docx_mode: mcp` or `docx_mode: cli` to select tool interface
- `skills/sara/SKILL.md` (lines 181-201) — Documents Sara's tool selection logic

**Work Product Storage:**
- Runtime: Created at `Sara-Work-Product/[matter-name]/` with subdirectories:
  - `final/` — Partner-ready deliverables (memos, drafts, redlines, transmittals)
  - `analysis/` — Sara's analytical work (intake notes, initial reads, frameworks, maps)
  - `research/` — Research materials and findings
  - `junior-work/` — Raw junior associate output before Sara's review
  - `prompt-log.md` — Audit trail of all delegations and analytical steps

## Naming Conventions

**Files:**

- **Skill/Agent files:** lowercase with hyphens: `legal-researcher.md`, `document-drafter.md`
- **Command files:** lowercase with hyphens: `sara.md`, `docx-mode.md`
- **Core modules:** lowercase with underscores: `reader.py`, `writer.py`, `redliner.py`
- **CLI scripts:** lowercase with underscores: `read.py`, `write.py`, `redline.py`
- **Test files:** `test_[module].py`: `test_reader.py`, `test_writer.py`
- **Work product files:** descriptive kebab-case prefixed by type:
  - `memo-[topic].md` (memoranda)
  - `draft-[document].md` (draft agreements)
  - `redline-[document].docx` (redlined documents)
  - `transmittal-[document].md` (cover memos)
  - `research-[topic].md` (research findings)

**Directories:**

- **Matter directories:** kebab-case: `sara-work-product/acquisition-acme-corp-2026/`, `sara-work-product/lease-review-downtown-office/`
- **Feature directories:** lowercase: `skills/`, `agents/`, `commands/`, `docx-tools/core/`, `docx-tools/cli/`
- **Analysis directories:** `analysis/`, `research/`, `junior-work/`

## Where to Add New Code

**New Feature (e.g., Lemma bank integration):**
- Primary code: Create new module in `docx-tools/core/lemma_bank.py`
- Expose via: Add `@mcp.tool()` wrapper to `docx-tools/mcp_server.py`
- CLI fallback: Create `docx-tools/cli/lemma.py` invoking the core module
- Tests: `docx-tools/tests/test_lemma_bank.py`

**New Command (e.g., /sara-junior to invoke a specific junior directly):**
- Command definition: Create `commands/new-command.md` following `sara.md` structure
- Register: Plugin system auto-discovers files in `commands/`

**New Junior Associate Agent:**
- Agent definition: Create `agents/specialty-role.md` following existing agent patterns
- Register: Plugin system auto-discovers files in `agents/`
- Integration: Reference from `skills/sara/SKILL.md` (Delegation section) with Task tool usage example

**Utilities / Helper Functions:**
- Core utilities: `docx-tools/core/[module_name].py` if document-related
- General utilities: Create as needed; follow module naming (lowercase_underscore.py)

**Work Product (when running Sara):**
- All deliverables: Saved to `Sara-Work-Product/[matter-name]/` with appropriate subdirectory
- Audit trail: Every delegation and major step logged to `prompt-log.md`

## Special Directories

**`docx-tools/.venv/`:**
- Purpose: Python virtual environment for document processing
- Generated: Yes (created by `uv sync` or `uv pip install`)
- Committed: No (.gitignore excludes .venv)
- Activation: `source ${CLAUDE_PLUGIN_ROOT}/docx-tools/.venv/bin/activate` before running Python scripts

**`Sara-Work-Product/[matter]/`:**
- Purpose: Matter-specific work product storage (created at runtime)
- Generated: Yes (created on first assignment to that matter)
- Committed: No (work product is transient; only final versions may be committed separately)
- Structure: Matches template in `skills/sara/SKILL.md` (lines 49-72)

**`.planning/codebase/`:**
- Purpose: GSD-generated codebase analysis documents
- Generated: Yes (by `/gsd:map-codebase` command)
- Committed: Yes (part of project documentation)
- Contents: ARCHITECTURE.md, STRUCTURE.md, CONVENTIONS.md, TESTING.md, CONCERNS.md as applicable

---

*Structure analysis: 2026-02-17*
